<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÑ Merry Christmas</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: sans-serif; }
        #loading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; color: #d4af37; z-index: 999;
            display: flex; justify-content: center; align-items: center;
            font-size: 20px; transition: opacity 1s;
        }
        h1 {
            position: absolute; top: 20px; width: 100%; text-align: center;
            color: #d4af37; pointer-events: none; font-size: 30px;
            text-shadow: 0 0 10px #d4af37; z-index: 10; margin: 0;
            font-family: 'Times New Roman', serif;
        }
        .tips {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: rgba(255,255,255,0.5); font-size: 12px; pointer-events: none;
        }
    </style>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
</head>
<body>
    <div id="loading">Loading...</div>
    <h1>Merry Christmas</h1>
    <div class="tips">Â∑¶Âè≥ÊªëÂä®ÊóãËΩ¨ ¬∑ ÂèåÂáªÂàáÊç¢Ê®°Âºè</div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';

        // Âú∫ÊôØÂàùÂßãÂåñ
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2, 50);
        
        const renderer = new THREE.WebGLRenderer({antialias: false});
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        // ÁÅØÂÖâ
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        const pLight = new THREE.PointLight(0xffaa00, 2, 50);
        scene.add(pLight);

        // Á≤íÂ≠êÁ≥ªÁªü
        const geometry = new THREE.BufferGeometry();
        const count = 1500;
        const positions = new Float32Array(count * 3);
        const colors = new Float32Array(count * 3);
        const speeds = [];

        const color1 = new THREE.Color(0xd4af37); // Èáë
        const color2 = new THREE.Color(0xaa0000); // Á∫¢

        for(let i=0; i<count; i++) {
            positions[i*3] = (Math.random()-0.5)*50;
            positions[i*3+1] = (Math.random()-0.5)*50;
            positions[i*3+2] = (Math.random()-0.5)*50;
            
            const c = Math.random()>0.5 ? color1 : color2;
            colors[i*3] = c.r; colors[i*3+1] = c.g; colors[i*3+2] = c.b;

            speeds.push({
                y: Math.random(), 
                h: Math.random(), // È´òÂ∫¶ÊØî‰æã 0-1
                angle: Math.random() * Math.PI * 2,
                r: 10 + Math.random() * 5
            });
        }
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

        const material = new THREE.PointsMaterial({
            size: 0.6, vertexColors: true, blending: THREE.AdditiveBlending, depthWrite: false
        });
        const particles = new THREE.Points(geometry, material);
        scene.add(particles);

        // ÂêéÂ§ÑÁêÜ (ÂèëÂÖâ)
        const composer = new EffectComposer(renderer);
        composer.addPass(new RenderPass(scene, camera));
        composer.addPass(new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85));

        // Âä®ÁîªÈÄªËæë
        let mode = 0; // 0: Tree, 1: Scatter
        let time = 0;

        // Ëß¶Êë∏ÊéßÂà∂
        let targetRotY = 0;
        let startX = 0;
        document.addEventListener('touchstart', e => startX = e.touches[0].clientX);
        document.addEventListener('touchmove', e => {
            const delta = e.touches[0].clientX - startX;
            targetRotY += delta * 0.005;
            startX = e.touches[0].clientX;
        });
        document.addEventListener('dblclick', () => mode = 1 - mode);

        // ÂéªÊéâ Loading
        document.getElementById('loading').style.display = 'none';

        function animate() {
            requestAnimationFrame(animate);
            time += 0.01;

            const pos = geometry.attributes.position.array;

            for(let i=0; i<count; i++) {
                const s = speeds[i];
                let tx, ty, tz;

                if(mode === 0) { // Tree
                    const h = -15 + s.h * 30;
                    const r = 12 * (1 - s.h); // Èî•ÂΩ¢
                    const angle = s.h * 20 + s.angle + time * 0.2;
                    tx = Math.cos(angle) * r;
                    ty = h;
                    tz = Math.sin(angle) * r;
                } else { // Scatter
                    tx = Math.sin(time + i) * 20;
                    ty = Math.cos(time + i*0.5) * 20;
                    tz = Math.sin(time + i*0.2) * 20;
                }

                // Lerp ÁßªÂä®
                pos[i*3] += (tx - pos[i*3]) * 0.05;
                pos[i*3+1] += (ty - pos[i*3+1]) * 0.05;
                pos[i*3+2] += (tz - pos[i*3+2]) * 0.05;
            }
            geometry.attributes.position.needsUpdate = true;

            particles.rotation.y += (targetRotY - particles.rotation.y) * 0.1;
            composer.render();
        }
        animate();
    </script>
</body>
</html>
