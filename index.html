<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Merry Christmas</title>
    <style>
        body {
            background-color: #000;
            margin: 0;
            overflow: hidden;
            touch-action: none; /* ç¦æ­¢ç¼©æ”¾ */
        }
        canvas { display: block; }
        .ui {
            position: absolute; top: 15%; width: 100%; text-align: center;
            pointer-events: none; z-index: 10;
        }
        h1 {
            color: #d4af37; font-family: 'Times New Roman', serif; 
            font-size: 40px; margin: 0;
            text-shadow: 0 0 15px rgba(212,175,55,0.8);
        }
        p { color: rgba(255,255,255,0.5); font-size: 12px; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="ui">
        <h1>Merry Christmas</h1>
        <p>ğŸ„ ä¿®æ­£ç‰ˆï¼šå°–ç«¯æœä¸Š ğŸ„</p>
    </div>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        const particles = [];
        
        let angleY = 0;
        let autoRotate = true;
        const FOCAL = 800; 

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor(type) {
                this.type = type; 
                this.reset();
            }

            reset() {
                // æ ¸å¿ƒä¿®æ­£é€»è¾‘ï¼š
                // Yè½´åæ ‡èŒƒå›´ï¼š-300(é¡¶éƒ¨) åˆ° 300(åº•éƒ¨)
                this.y = Math.random() * 600 - 300; 
                
                // è®¡ç®—å½“å‰é«˜åº¦çš„ç™¾åˆ†æ¯”ï¼š0æ˜¯é¡¶éƒ¨ï¼Œ1æ˜¯åº•éƒ¨
                // ä¹‹å‰å†™åäº†ï¼Œç°åœ¨ä¿®æ­£ï¼š
                const percent = (this.y + 300) / 600; 

                if (this.type === 'leaf' || this.type === 'deco') {
                    // åŠå¾„æ§åˆ¶ï¼šé¡¶éƒ¨(percent=0)åŠå¾„å°ï¼Œåº•éƒ¨(percent=1)åŠå¾„å¤§
                    // åº•éƒ¨æœ€å®½ 220px
                    const maxR = 10 + Math.pow(percent, 1.2) * 220; 
                    
                    const angle = Math.random() * Math.PI * 2;
                    // å®å¿ƒåŒ–å¤„ç†ï¼šç²’å­ä¸ä»…ä»…åœ¨è¡¨é¢ï¼Œä¹Ÿå¡«å……å†…éƒ¨
                    const r = maxR * Math.sqrt(Math.random());

                    this.x = Math.cos(angle) * r;
                    this.z = Math.sin(angle) * r;
                    
                    if (this.type === 'leaf') {
                        const g = Math.floor(100 + Math.random() * 155);
                        this.color = `rgba(0, ${g}, 50, 0.8)`;
                        this.size = 1.8;
                    } else {
                        // è£…é¥°åªåœ¨è¡¨é¢
                        this.x = Math.cos(angle) * maxR;
                        this.z = Math.sin(angle) * maxR;
                        this.color = Math.random() > 0.5 ? '#ffd700' : '#ff3333';
                        this.size = 3.5;
                    }
                } 
                else if (this.type === 'trunk') {
                    // æ ‘å¹²
                    const angle = Math.random() * Math.PI * 2;
                    const r = Math.random() * 20;
                    this.x = Math.cos(angle) * r;
                    this.z = Math.sin(angle) * r;
                    this.y = 300 + Math.random() * 80; // åœ¨æœ€åº•ä¸‹
                    this.color = '#5c4033';
                    this.size = 2;
                }
                else if (this.type === 'snow') {
                    this.x = (Math.random() - 0.5) * width;
                    this.y = (Math.random() - 0.5) * height;
                    this.z = (Math.random() - 0.5) * 600;
                    this.color = 'rgba(255,255,255,0.6)';
                    this.size = Math.random() * 2 + 0.5;
                    this.fallSpeed = 1 + Math.random();
                }
            }

            update() {
                // é›ªèŠ±ä¸‹è½
                if (this.type === 'snow') {
                    this.y += this.fallSpeed;
                    if (this.y > 400) this.y = -400;
                }

                // æ—‹è½¬
                const cos = Math.cos(angleY);
                const sin = Math.sin(angleY);
                const rx = this.x * cos - this.z * sin;
                const rz = this.z * cos + this.x * sin;

                // æŠ•å½±
                const depth = FOCAL + rz;
                const scale = FOCAL / depth;

                this.projX = width / 2 + rx * scale;
                // æ³¨æ„ï¼šCanvasçš„Yæ˜¯å‘ä¸‹çš„ï¼Œ-300æ˜¯ä¸Šé¢ï¼Œ300æ˜¯ä¸‹é¢ï¼Œæ˜¾ç¤ºæ²¡é—®é¢˜
                this.projY = height / 2 + (this.y - 20) * scale; 
                this.projSize = this.size * scale;
                this.projScale = scale;
                this.isVisible = depth > 0;
            }

            draw() {
                if (!this.isVisible) return;
                ctx.beginPath();
                ctx.fillStyle = this.color;
                if(this.type === 'deco') {
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = this.color;
                } else {
                    ctx.shadowBlur = 0;
                }
                ctx.arc(this.projX, this.projY, this.projSize, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // æ˜Ÿæ˜Ÿ
        class Star {
            constructor() {
                this.y = -315; // åœ¨é¡¶éƒ¨ (-300) å†å¾€ä¸Šä¸€ç‚¹
                this.size = 25;
                this.color = '#ffd700';
            }
            draw() {
                const cos = Math.cos(angleY);
                const sin = Math.sin(angleY);
                // æ˜Ÿæ˜Ÿåœ¨ä¸­å¿ƒè½´æ—‹è½¬
                const depth = FOCAL + (0 * cos + 0 * sin); 
                const scale = FOCAL / depth;
                
                const px = width / 2;
                const py = height / 2 + (this.y - 20) * scale;

                if (depth > 0) {
                    ctx.save();
                    ctx.translate(px, py);
                    ctx.rotate(-angleY); // è‡ªè½¬
                    ctx.beginPath();
                    ctx.fillStyle = this.color;
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = this.color;
                    for (let i = 0; i < 5; i++) {
                        ctx.lineTo(Math.cos((18 + i * 72) * 0.01745) * this.size * scale,
                                   -Math.sin((18 + i * 72) * 0.01745) * this.size * scale);
                        ctx.lineTo(Math.cos((54 + i * 72) * 0.01745) * this.size * 0.5 * scale,
                                   -Math.sin((54 + i * 72) * 0.01745) * this.size * 0.5 * scale);
                    }
                    ctx.closePath();
                    ctx.fill();
                    ctx.restore();
                }
            }
        }

        function init() {
            for(let i=0; i<1600; i++) particles.push(new Particle('leaf'));
            for(let i=0; i<180; i++) particles.push(new Particle('deco'));
            for(let i=0; i<100; i++) particles.push(new Particle('trunk'));
            for(let i=0; i<300; i++) particles.push(new Particle('snow'));
        }
        
        const star = new Star();
        init();

        // äº¤äº’
        let startX = 0;
        let isDragging = false;
        document.addEventListener('touchstart', e => { startX = e.touches[0].clientX; isDragging = true; });
        document.addEventListener('touchmove', e => {
            if(isDragging) {
                const dx = e.touches[0].clientX - startX;
                angleY -= dx * 0.005;
                startX = e.touches[0].clientX;
                autoRotate = false;
            }
        });
        document.addEventListener('touchend', () => { isDragging = false; autoRotate = true; });

        function animate() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);

            if(autoRotate) angleY += 0.008;

            particles.forEach(p => p.update());
            // æ’åºå¾ˆé‡è¦ï¼šè¿œçš„å…ˆç”»
            particles.sort((a, b) => b.projScale - a.projScale);
            particles.forEach(p => p.draw());
            
            star.draw();
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
